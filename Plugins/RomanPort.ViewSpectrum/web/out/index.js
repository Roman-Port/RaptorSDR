var RaptorPlugin;(()=>{var t={375:(t,e,i)=>{"use strict";var s,a;i.d(e,{Z:()=>u}),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom"}(s||(s={}));class n{constructor(t,e){this.x=t,this.y=e}}!function(t){t.GENRAL="GENERAL",t.EXTRA="EXTRA",t.PLUGIN="PLUGIN",t.PINNED="PINNED",t.MENU="MENU",t.NONE="NONE"}(a||(a={}));class r{constructor(t){this.container=t,this.enabled=!0,this.container.style.display="absolute",this.container.style.left="0",this.container.style.right="0",this.container.style.backgroundColor="black",this.SetOffset(0),this.mainCanvas=this.CreateComponent("canvas"),this.mainCanvasContext=this.mainCanvas.getContext("2d"),this.mainCanvas.style.position="absolute",this.mainCanvas.style.left=g.PADDING_LEFT+"px",this.mainCanvas.style.top="0"}Update(t,e,i,s){this.mainCanvas.width=t-g.PADDING_WIDTH,this.mainCanvas.height=e,this.container.style.height=e+"px"}SetOffset(t){this.container.style.top=t+"px"}SetEnabled(t){this.enabled=t}ProcessFrame(t){this.enabled&&this.DrawFrame(t)}CreateComponent(t){var e=document.createElement(t);return this.container.appendChild(e),e}}class h{constructor(t,e,i){this.canvas=t,this.context=this.canvas.getContext("2d"),this.width=e,this.height=i,this.canvas.width=this.width,this.canvas.height=this.height}DrawYAxis(t,e){for(var i=(this.height-o.PADDING_HEIGHT)/12,s=5;e/s>i;)s*=2;var a=h.FindPixelPoints(t,t+e,s,this.height-o.PADDING_HEIGHT),n=this.CreateFilledImageData(this.width-g.PADDING_WIDTH,1);this.context.font="10px Roboto",this.context.fillStyle="white",this.context.textAlign="right";for(var r=0;r<a.length;r++)this.context.fillText(a[r][0].toString(),g.PADDING_LEFT-3,a[r][1]+5+o.PADDING_TOP,g.PADDING_LEFT-3),this.context.putImageData(n,g.PADDING_LEFT,a[r][1]+o.PADDING_TOP);return this}DrawXAxis(t,e,i,s){var a,n;i?(a=e-t/2,n=e+t/2):(a=e,n=e+t);var r,l=(this.width-g.PADDING_WIDTH)/50;if(null==s||0==s)for(r=1;;){var d=r;if((n-a)/(r=5*d)<=l)break;if((n-a)/(r=10*d)<=l)break}else r=s;var c=h.FindPixelPoints(a,n,r,this.width-g.PADDING_WIDTH),p=this.CreateFilledImageData(1,this.height-o.PADDING_HEIGHT);this.context.font="10px Roboto",this.context.fillStyle="white",this.context.textAlign="center";for(var u=0;u<c.length;u++)this.context.fillText(this.FormatFreq(c[u][0]),c[u][1]+g.PADDING_LEFT,this.height-o.PADDING_TOP/2-5-2),this.context.putImageData(p,c[u][1]+g.PADDING_LEFT,o.PADDING_TOP);return this}FormatFreq(t){if(0==t)return"DC";for(var e=0;t>=1e3;)t/=1e3,e++;return t=Math.round(t*h.FREQ_ROUNDING),Math.floor(t/h.FREQ_ROUNDING).toString()+"."+(t%h.FREQ_ROUNDING).toString().padEnd(3,"0")+" "+h.FREQ_FORMATS[e]}CreateFilledImageData(t,e){for(var i=this.context.createImageData(t,e),s=e*t*4,a=0;a<s;)i.data[a++]=255,i.data[a++]=255,i.data[a++]=255,i.data[a++]=60;return i}static FindPixelPoints(t,e,i,s){for(var a=s/(e-t),n=[],r=Math.ceil(t/i)*i;r<=e;r+=i)n.push([r,Math.floor((r-t)*a)]);return n}}h.FREQ_FORMATS=["","k","M","G","T"],h.FREQ_ROUNDING=100;class o extends r{constructor(t,e){super(t),this.height=0,this.width=0,this.info=e,this.mainCanvas.style.top=o.PADDING_TOP+"px",this.scaleCanvas=document.createElement("canvas"),t.appendChild(this.scaleCanvas),this.scaleCanvas.style.position="absolute",this.scaleCanvas.style.top="0",this.scaleCanvas.style.left="0",this.scaleCanvas.style.pointerEvents="none"}Update(t,e,i,s){super.Update(t,e-o.PADDING_HEIGHT,i,s),this.height=e,this.width=t,this.foregroundGradient=this.mainCanvasContext.createLinearGradient(0,0,0,e-o.PADDING_HEIGHT),this.foregroundGradient.addColorStop(0,"#70b4ff"),this.foregroundGradient.addColorStop(1,"#000050"),this.backgroundGradient=this.mainCanvasContext.createLinearGradient(0,0,0,e-o.PADDING_HEIGHT),this.backgroundGradient.addColorStop(0,"#345375"),this.backgroundGradient.addColorStop(1,"#000014")}SettingsChanged(t,e,i,s){null!=t&&null!=e&&null!=i&&null!=s&&this.width>0&&this.height>0&&this.enabled&&0!=e&&0!=s&&new h(this.scaleCanvas,this.width,this.height).DrawYAxis(i,s).DrawXAxis(e,t,this.info.useCenterFreq,this.info.fixedIncrement)}DrawFrame(t){var e;this.mainCanvasContext.fillStyle=this.foregroundGradient,this.mainCanvasContext.fillRect(0,0,this.mainCanvas.width,this.mainCanvas.height),this.mainCanvasContext.beginPath(),this.mainCanvasContext.moveTo(0,t[0]*this.mainCanvas.height),this.mainCanvasContext.strokeStyle="white",this.mainCanvasContext.fillStyle=this.backgroundGradient;for(var i=1;i<t.length;i++)e=Math.floor(t[i]*this.mainCanvas.height),this.mainCanvasContext.lineTo(i,e),this.mainCanvasContext.fillRect(i,0,1,e);this.mainCanvasContext.stroke()}}o.PADDING_TOP=5,o.PADDING_BOTTOM=25,o.PADDING_HEIGHT=o.PADDING_TOP+o.PADDING_BOTTOM;class l extends r{constructor(t){super(t),this.precomputedColors=[];for(var e=0;e<256;e++)this.precomputedColors.push(l.CalculateColor(e/256))}SettingsChanged(t,e,i,s){}Update(t,e,i,s){if(0==t||0==e||0==this.mainCanvas.width||0==this.mainCanvas.height)super.Update(t,e,i,s);else{var a=this.mainCanvasContext.getImageData(0,0,this.mainCanvas.width,this.mainCanvas.height),n=this.mainCanvas.width,r=this.mainCanvas.height;super.Update(t,e,i,s);var h=Math.min(e,r),o=t-g.PADDING_WIDTH,l=n/o;if(1==l)this.mainCanvasContext.putImageData(a,0,0);else{for(var d=this.mainCanvasContext.createImageData(o,h),c=0;c<h;c++)for(var p=0;p<o;p++){var u=4*(c*n+Math.floor(p*l)),f=4*(c*o+p);d.data[f+0]=a.data[u+0],d.data[f+1]=a.data[u+1],d.data[f+2]=a.data[u+2],d.data[f+3]=a.data[u+3]}this.mainCanvasContext.putImageData(d,0,0)}}}DrawFrame(t){this.mainCanvasContext.drawImage(this.mainCanvas,0,1);for(var e,i=this.mainCanvasContext.createImageData(this.mainCanvas.width,1),s=0,a=0;a<t.length;a++)e=this.precomputedColors[Math.floor(255*t[a])],i.data[s++]=e[0],i.data[s++]=e[1],i.data[s++]=e[2],i.data[s++]=255;this.mainCanvasContext.putImageData(i,0,0)}static CalculateColor(t){t=1-t,t=Math.max(0,t),t=Math.min(1,t);var e=l.WATERFALL_COLORS.length-1,i=this.WATERFALL_COLORS[Math.floor(t*e)],s=this.WATERFALL_COLORS[Math.ceil(t*e)],a=t*e-Math.floor(t*e);return[Math.ceil(s[0]*a+i[0]*(1-a)),Math.ceil(s[1]*a+i[1]*(1-a)),Math.ceil(s[2]*a+i[2]*(1-a))]}}l.WATERFALL_COLORS=[[0,0,32],[0,0,48],[0,0,80],[0,0,145],[30,144,255],[255,255,255],[255,255,0],[254,109,22],[255,0,0],[198,0,0],[159,0,0],[117,0,0],[74,0,0]];class d{constructor(){this.subscriptions=[]}Bind(t){this.subscriptions.push(t)}Unbind(t){for(var e=0;e<this.subscriptions.length;e++)if(this.subscriptions[e]==t)return this.subscriptions.splice(e,1),!0;return!1}Fire(t){for(var e=0;e<this.subscriptions.length;e++){var i=this.subscriptions[e](t);null!=i&&!0===i&&(this.subscriptions.splice(e),e--)}}}class c{constructor(t,e,i){this.hd=i,this.SampleRateChanged=new d,this.FrameReceived=new d,this.sock=t.GetStream(e.id).AddQueryArgument("hd",i.toString()).AsWebSocket(),this.sock.onmessage=t=>{this.OnFrame(t.data)},this.connect=new Promise(((t,e)=>{this.sock.onopen=()=>t(),this.sock.onclose=()=>e()}))}SetSize(t){this.UpdateWebValue("size",t)}SetAttack(t){this.UpdateWebValue("attack",t)}SetDecay(t){this.UpdateWebValue("decay",t)}SetOffset(t){this.UpdateWebValue("offset",t)}SetRange(t){this.UpdateWebValue("range",t)}GetSampleRate(){return this.sampleRate}WaitConnect(){return this.connect}UpdateWebValue(t,e){var i={};i[t]=e,this.WaitConnect().then((()=>{this.sock.send(JSON.stringify(i))}))}OnFrame(t){var e=new DataView(t);this.sampleRate!=e.getUint32(0,!0)&&(this.sampleRate=e.getUint32(0,!0),this.SampleRateChanged.Fire(this.sampleRate));var i=(t.byteLength-4)/(this.hd?2:1),s=new Float32Array(i),a=4;if(this.hd)for(var n=0;n<i;n++)s[n]=e.getUint16(a,!0)/65535,a+=2;else for(n=0;n<i;n++)s[n]=e.getUint8(a++)/255;this.FrameReceived.Fire(s)}}class p{constructor(t,e,i,s){this.OnChanged=new d,this.window=t,this.configKey=e,this.callback=i,this.scale=null==s?1:s}GetValue(){return this.window.persist[this.configKey]*this.scale}SetValue(t){return e=this,i=void 0,a=function*(){t/=this.scale,this.window.persist[this.configKey]=t,this.callback(t),this.window.SettingsChanged(),this.OnChanged.Fire(t)},new((s=void 0)||(s=Promise))((function(t,n){function r(t){try{o(a.next(t))}catch(t){n(t)}}function h(t){try{o(a.throw(t))}catch(t){n(t)}}function o(e){var i;e.done?t(e.value):(i=e.value,i instanceof s?i:new s((function(t){t(i)}))).then(r,h)}o((a=a.apply(e,i||[])).next())}));var e,i,s,a}}class g{constructor(t){this.parts=[],this.persistentSpectrumHeightUpdated=!1,this.ctx=t,this.conn=t.conn,this.info=t.info,this.persist=t.persist,this.PersistSetDefault("offset",this.info.defaultOffset),this.PersistSetDefault("range",this.info.defaultRange),this.PersistSetDefault("attack",this.info.defaultAttack),this.PersistSetDefault("decay",this.info.defaultDecay);var e=t.CreateSettingsRegion(this.info.name+" Settings","settings").AddOptionRange("Offset",new p(this,"offset",(t=>this.sock.SetOffset(t))),0,200).AddOptionRange("Range",new p(this,"range",(t=>this.sock.SetRange(t))),1,200).AddOptionRange("Attack",new p(this,"attack",(t=>this.sock.SetAttack(t)),100),0,100).AddOptionRange("Decay",new p(this,"decay",(t=>this.sock.SetDecay(t)),100),0,100).Build();t.RegisterSettingsRegionSidebar(e,a.GENRAL)}GetWindowName(){return this.info.name}CreateWindow(t){this.window=t,null!=this.info.freqDataProvider&&(this.freqDataProvider=this.conn.GetPrimitiveDataProvider(this.info.freqDataProvider),this.freqDataProvider.OnChanged.Bind((()=>{this.SettingsChanged()}))),this.sock=new c(this.conn,this.info,!0),this.sock.SampleRateChanged.Bind((()=>{this.SettingsChanged()})),this.sock.SetOffset(this.persist.offset),this.sock.SetRange(this.persist.range),this.sock.SetAttack(this.persist.attack),this.sock.SetDecay(this.persist.decay),this.parts=[new o(this.CreateContainer(t),this.info),new l(this.CreateContainer(t))],this.sock.FrameReceived.Bind((t=>{for(var e=0;e<this.parts.length;e++)this.parts[e].ProcessFrame(t)})),this.slider=this.CreateContainer(t),this.slider.style.width="15px",this.slider.style.height="32px",this.slider.style.right="0",this.slider.style.zIndex="99",this.slider.style.borderRadius="3px",this.slider.style.cursor="pointer",this.slider.style.backgroundColor="#2C2F33",this.slider.style.display="flex",this.slider.style.flexDirection="column",this.slider.addEventListener("mousedown",(()=>this.sliderDragging=!0)),this.CreateSliderIcon(this.slider,!1),this.CreateSliderIcon(this.slider,!0),window.addEventListener("mouseup",(()=>this.sliderDragging=!1)),window.addEventListener("mousemove",(t=>{this.sliderDragging&&(this.spectrumHeight+=t.movementY,this.ConfigureLayout(),t.preventDefault(),t.stopPropagation())}))}DestoryWindow(){}ResizeWindow(t,e){0!=e&&(this.persistentSpectrumHeightUpdated||(this.spectrumHeight=e*(null==this.persist.spectrumHeightPercent?.5:this.persist.spectrumHeightPercent),this.persistentSpectrumHeightUpdated=!0),this.ConfigureLayout(),this.sock.SetSize(t-g.PADDING_WIDTH))}SettingsChanged(){for(var t=0;t<this.parts.length;t++)this.parts[t].SettingsChanged(null==this.freqDataProvider?0:this.freqDataProvider.GetValue(),this.sock.GetSampleRate(),this.persist.offset,this.persist.range)}ConfigureLayout(){var t=this.window.clientHeight,e=this.window.clientWidth;this.spectrumHeight=Math.max(0,Math.min(this.window.clientHeight,this.spectrumHeight)),this.spectrumHeight<30?(this.parts[1].Update(e,t,this.persist.offset,this.persist.range),this.parts[1].SetEnabled(!0),this.parts[1].SetOffset(0),this.parts[0].SetEnabled(!1),this.parts[0].Update(e,0,this.persist.offset,this.persist.range),this.slider.style.top="-15px"):this.window.clientHeight-this.spectrumHeight<30?(this.parts[0].Update(e,t,this.persist.offset,this.persist.range),this.parts[0].SetEnabled(!0),this.parts[0].SetOffset(0),this.parts[1].SetEnabled(!1),this.parts[1].Update(e,0,this.persist.offset,this.persist.range),this.slider.style.top=t-15+"px"):(this.parts[0].Update(e,this.spectrumHeight,this.persist.offset,this.persist.range),this.parts[1].Update(e,t-this.spectrumHeight,this.persist.offset,this.persist.range),this.parts[0].SetOffset(0),this.parts[1].SetOffset(this.spectrumHeight),this.parts[0].SetEnabled(!0),this.parts[1].SetEnabled(!0),this.slider.style.top=this.spectrumHeight-15+"px"),this.SettingsChanged(),this.persist.spectrumHeightPercent=this.spectrumHeight/t}CreateContainer(t){var e=document.createElement("div");return e.style.position="absolute",t.appendChild(e),e}CreateSliderIcon(t,e){var i=document.createElement("div");i.style.width="15px",i.style.backgroundImage="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjRweCIgdmlld0JveD0iMCAwIDI0IDI0IiB3aWR0aD0iMjRweCIgZmlsbD0iI0ZGRkZGRiI+PHBhdGggZD0iTTAgMGgyNHYyNEgwVjB6IiBmaWxsPSJub25lIi8+PHBhdGggZD0iTTEyIDhsLTYgNiAxLjQxIDEuNDFMMTIgMTAuODNsNC41OSA0LjU4TDE4IDE0bC02LTZ6Ii8+PC9zdmc+)",i.style.backgroundSize="13px",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center",i.style.height="100%",i.style.flexGrow="1",i.style.pointerEvents="none",i.style.opacity="0.7",e&&(i.style.transform="scaleY(-1)"),t.appendChild(i)}PersistSetDefault(t,e){var i=this.persist;null==i[t]&&(i[t]=e)}}g.PADDING_LEFT=25,g.PADDING_RIGHT=15,g.PADDING_WIDTH=g.PADDING_LEFT+g.PADDING_RIGHT;class u{constructor(t){this.ctx=t}Init(){for(var t=this.ctx.conn.GetPrimitiveDataProvider(this.ctx.GetId()+".Spectrums").GetValue(),e=this.ctx.RegisterWindowClass({displayName:"Spectrum",id:"RomanPort.SpectrumPlugin.Spectrum",createInstance:t=>new g(t),hideHeader:!1,sizeMin:new n(100,100),sizeDefault:new n(400,300),sizeMax:new n(3840,99999)}),i=0;i<t.length;i++)e.RegisterInstance({displayName:t[i].name,info:t[i],id:t[i].id}).RequestMount(s.Center,10)}}},138:(t,e,i)=>{const s=i(375).Z;t.exports=s}},e={};function i(s){var a=e[s];if(void 0!==a)return a.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var s=i(138);RaptorPlugin=s})();